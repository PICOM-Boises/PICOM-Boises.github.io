<!doctype html>
<html lang="fr"> 
<head> 
	<meta charset="utf-8">
	<title>Projet PICOM boisés UQTR</title> 
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<script src="indice_geojson.json"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
</head>
<body>
<h1>Les forêts urbaines vieilles et distancées des infrastructures remplissent le plus grand nombre de services écosystémiques </h1>
<p>La nature urbaine offre aux citadins de multiples bienfaits à plusieurs égards ; c’est le cas par exemple au niveau écologique à travers la régulation de la température de l’air ou l’augmentation de biodiversité, et au niveau de la qualité de vie à travers l’amélioration de la santé physique et mentale. De plus en plus d’initiatives municipales à travers le monde se penchent ainsi sur l’identification et le maintien de ces services, à l’heure ou ces derniers risquent d’être durement touchés par les changements climatiques. 
	Cependant, peu de recherche s’est concentrée sur les services offerts et les risques encourus par la nature urbaine sur les campus universitaires. 
	C’est dans ce contexte que nous avons mené cette étude, qui vise à quantifier une gamme de services et de risques associés aux écosystèmes du campus de l'Université du Québec à Trois-Rivières (UQTR). 
</p>
<p>
	En combinant des méthodes de télédétection avec des données terrain, nous avons évalué six services écosystémiques, tels que la régulation de la température de l’air et le stockage de carbone, la perméabilité des sols et le niveau de biodiversité, ainsi que cinq risques, tels que le taux de mortalité des arbres, leur niveau de maladies causées par les pathogènes et la présence d'espèces exotiques envahissantes. Un indice écosystémique global a ensuite été élaboré pour comparer la performance des différents écosystèmes. 
</p>	
<p>
	Nos résultats ont révélé une grande variabilité de services et de risques entre les écosystèmes, que la carte interactive ci-dessous permet d'explorer.
</p>	

<div id="map" style="height:600px" ></div>

	<div class="legende" id="indice_carbone">
		<h3>Captation de carbone</h3>
		<p>Service de régulation. Les arbres captent le carbone atmosphérique et le stockent dans leur biomasse et les horizons profonds du sol, contribuant à la lutte contre les gaz à effet de serre.</p>
		<p><strong>Données utilisées :</strong> Inventaires réalisés en 2016 et 2023 sur 36 parcelles de 400 m², incluant des mesures de diamètre à hauteur de poitrine (DHP) et des équations allométriques. Trois indicateurs composent l’indice : variation de carbone accumulé, productivité annuelle moyenne et stock de biomasse.</p>
	</div>
	
	<div class="legende" id="indice_permeabilite">
<h3>Perméabilité du sol :</h3>
<p>Service de régulation. Les sols perméables permettent à l’eau de pluie de s’infiltrer vers la nappe phréatique, réduisant les volumes de ruissellement et les risques d’inondation.</p>
<p><strong>Données utilisées :</strong> Classification théorique des surfaces selon leur potentiel de ruissellement (sol, couverture végétale et urbanisation), fondée sur les numéros de courbes de ruissellement (Cronshey, 1986).</p>
</div>
<div class="legende" id="indice_temperature">
<h3>Température de surface : </h3>
<p>Service de régulation. Les surfaces minéralisées créent le phénomène des îlots de chaleur durant l’été. En revanche, les écosystèmes forestiers rafraîchissent l’atmosphère par la transpiration foliaire et la création d’ombre. En hiver, ils retiennent la chaleur et réduisent la force du vent.</p>
<p><strong>Données utilisées :</strong> Données de télédétection (bande thermale Landsat 8/9) acquises entre 2019 et 2023 et données issues de 57 sondes de température insérées dans le sol.</p>
	</div>
<div class="legende" id="indice_biodiversite">
<h3>Biodiversité </h3>
<p>Service de support. Une plus grande diversité végétale améliore la résilience des forêts et amplifie les services rendus. </p>
<p><strong>Données utilisées :</strong> Données issues de l’inventaire floristique de 2009 (plantes vasculaires) et de l’inventaire forestier de 2016 (diversité arborée). </p>
	</div>
<div class="legende" id="indice_service_culturel">
<h3>Interaction humaine avec les écosystèmes</h3>
<p>Service culturel. La nature urbaine procure des bienfaits physiques et mentaux qui augmentent avec la fréquence d’utilisation et la diversité des activités pratiquées. </p>
<p><strong>Données utilisées :</strong>  Questionnaire distribué à la communauté universitaire. Deux indicateurs ont été retenus : fréquence d’utilisation et nombre moyen d’usages distincts par écosystème. Les données ont été normalisées et combinées.
	</div>
<div class="legende" id="indice_champignons">
<h3>Cueillette de champignons </h3>
<p>Service d’approvisionnement. Les champignons comestibles représentent une ressource alimentaire croissante, aussi bien pour les humains que pour la faune urbaine. </p>
<p><strong>Données utilisées :</strong> Évaluation de la probabilité d’occurrence de neuf espèces comestibles — bolet orangé, bolet à pied glabrescent, chanterelle commune, chanterelle en tube, morille blonde, champignon crabe, pleurote du peuplier, marasmes des oréades et coprin chevelu — selon l’âge de la forêt, le type d’arbres et la nature du sol. Chaque écosystème a reçu une note moyenne ramenée à un indice de 1 à 5.</p>
	</div>
<div class="legende" id="indice_mortalite">
<h3>Mortalité </h3>
<p>La mortalité massive des arbres pose un risque majeur pour les écosystèmes forestiers en perturbant leur structure et leur fonctionnement. Elle modifie la composition végétale, affecte le cycle des nutriments, réduit la séquestration du carbone et favorise l'invasion d'espèces exotiques, affaiblissant la résilience des forêts. </p>
<p><strong>Données utilisées :</strong> Comparaison des inventaires de 2016 et 2023. L’indice de risque correspond à la proportion moyenne d’arbres morts par écosystème, exprimée en pourcentage et normalisée.</p>
	</div>
<div class="legende" id="indice_maladies">
<h3>Maladies </h3>
<p>Les maladies affectant les écosystèmes peuvent inclure des infections causées par des champignons, des bactéries ou des virus. Ces pathogènes peuvent rapidement se propager perturbant les dynamiques des populations et affaiblissant les capacités de résilience des écosystèmes. </p>
<p><strong>Données utilisées :</strong> Évaluation de l’état de santé des arbres en 2023 avec la méthode MSCR (catégories M, S, C, R et arbres morts). Les cotes ont été converties en scores numériques, moyennées et normalisées.</p>
	</div>
<div class="legende" id="indice_depots_de_neige">
<h3>Dépôts de neige </h3>
<p>Les dépôts excessifs de neige peuvent casser les branches et comprimer les jeunes plants, ralentissant leur croissance. Le sel de route mêlé à la neige augmente la salinité des sols, provoquant un stress hydrique et des déséquilibres nutritifs. Cela peut entraîner la mort des espèces sensibles, avec des symptômes tels que le brunissement des feuilles et le dépérissement des branches. </p>
<p><strong>Données utilisées :</strong> Cartographie des dépôts par drone (DJI Mini 2) et application Mergin Maps. Le pourcentage de recouvrement de chaque écosystème par les dépôts a été calculé et transformé en indice de risque. </p>
	</div>
<div class="legende" id="indice_intemperies">
<h3>Intempéries</h3>
<p>Des tempêtes violentes peuvent provoquer des cassures ou des déracinements d’arbres, affectant la stabilité des écosystèmes. L’endurance d’un arbre face aux vents et aux intempéries est déterminée, en partie, par le type de ses racines : pivotantes, fasciculaires ou adventives.  </p>
<p><strong>Données utilisées :</strong> Longueurs maximales des racines par espèce tirées de la littérature. Calcul d’une moyenne pondérée par écosystème, normalisée pour générer un indice de risque. </p>
	</div>
<div class="legende" id="indice_especes_envahissantes">
<h3>Espèces exotiques envahissantes </h3>
<p>L’introduction d’espèces exotiques et envahissantes perturbe les écosystèmes locaux en entrant en compétition avec les espèces indigènes. Cette compétition désavantage les espèces locales, menant à leur déclin ou disparition, affectant les interactions écologiques et le fonctionnement global de l’écosystème. </p>
<p><strong>Données utilisées :</strong> Données utilisées : Recensement géolocalisé des occurrences de six espèces exotiques en août 2023, soit l’iris faux-acore, le nerprun bourdaine, la renouée du Japon, le roseau commun, la salicaire pourpre et l’érable de Norvège. Le nombre d’occurrences par hectare a été utilisé pour générer un indice de risque. </p>
		</div>
	
	<div class="legende" id="Combine">
		Importance à donner à chaque indice pour le combiné : <br />
	</div>
	
	<p>Pour plus de détails ou consulter l'étude originale, rendez-vous sur le <a href = "https://www.erudit.org/fr/revues/natcan/" target="_blank">site du Naturaliste Canadien</a>.</p>

	<p>Tous droits réservés 2025, <br />
		Jacob Isabelle, Thierry Laurent-St-Pierre, Jules Martin, Laurent J. Lamarque, Pierre-André Bordeleau, Charles A. Martin, Matteo Giacomazzo, Jessika Malko, Alexandre Roy et Vincent Maire
	</p>
	
	<script>

		// "properties":{"OBJECTID":1,"Catégorie":"Forestier","Type":"Pinède grise","zone_echan":23,"Field":0,"permeabilité":5,"carbone":4,"biodiversite":2,"temperature":3,"Indice":3.5,"Shape_Length":4477.8209635709882,"Shape_Area":81258.039305174549}

		const etiquette_indices_combines = "Personnaliser mon indice"
		
		const fillOpacity = 0.75;
		
		function getColorGradient(d) {
		    return d > 4 ? '#800026' :
		           d > 3  ? '#E31A1C' :
		           d > 2   ? '#FD8D3C' :
		           d > 1   ? '#FED976' :
		                      '#FFEDA0';
		}
		
		const liste_couleurs_ecosystemes = {
			"Pinède grise" : "#4a711a",
			"Jeune Pinède blanche" : "#cf2b30",
			"Mixte": "#4b3aba",
			"Mixte suranné" : "#0081a6",
			"Pinède blanche à pin gris" : "#95e2c3",
			"Pinède Sylvestre" : "#9f523d",
			"Vieille pinède blanche" : "#ee962a",
			"Pessière norvégienne" : "#27c8c2",
			"Milieu humide" : "#00c47c",
			"Pelouse arborée" : "#fff",
			"Surface minéralisée" : "#ccc",
			"Pelouse" : "#fffc47"			
		}
		
		function getColorES(d) {
			return liste_couleurs_ecosystemes[d];
		}
		
		function cleanToId(str) {
		  return str
		    .toLowerCase()                                      // Convert to lowercase.
		    .normalize('NFD')                                   // Decompose accented letters.
		    .replace(/[\u0300-\u036f]/g, '')                    // Remove diacritical marks.
		    .trim()                                             // Remove leading/trailing whitespace.
		    .replace(/\s+/g, '_')                               // Replace spaces with hyphens.
		    .replace(/[^a-z0-9\-_:.]/g, '');                     // Remove any non-allowed characters.
		}
				
		let map = L.map('map').setView([46.345, -72.580], 15);
		
		const tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 19,
				attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
			}).addTo(map);		

		let indices = {

			Type:"Écosystèmes",
			"Indice perméabilité":"Service : Perméabilité",
			"Indice température":"Service : Température",
			"Indice carbone":"Service : Carbone",
			"Indice biodiversité":"Service : Biodiversité",
			"Indice service culturel":"Service : Culturel",
			"Indice champignons":"Service : Champignons",

			"Indice écosystémique global":"Indice global services",

			"Indice dépots de neige":"Risque : Dépôts de neige",
			"Indice intempéries":"Risque : Intempéries",
			"Indice maladies":"Risque : Maladies",
			"Indice espèces envahissantes":"Risque : Espèces envahissantes",

			"Indice mortalité":"Risque : Mortalité",

			"Indice de risque global":"Indice global risques",
			
			// Dé-commenter cette ligne pour ré-activer la création d'un indice personnalisé
			// Combine:etiquette_indices_combines,
			
		}
		
		let a_enlever_du_calcul = ["Type", "Indice écosystémique global", "Indice de risque global","Combine"]
		
		for (let [cle,etiquette] of Object.entries(indices)) {
			if (!(a_enlever_du_calcul.map(cleanToId).includes(cleanToId(cle)))) {
				$('.legende#Combine').append(`${etiquette} : <input type="range" id="${cleanToId(cle)}"/><br />`);
			}
		}

		let mise_a_jour_indice_combine = function() {
			for (feature of layers_picom.features) {
						
				let somme_valeurs = 0;
				let somme_poids = 0;
				
				for (indice of Object.keys(indices)) {
					if (!(a_enlever_du_calcul.includes(indice))) {
						//console.log("indice:" + indice)
						//console.log("property:" + feature.properties[indice])
						//console.log("value:" + $('input[type=range]#'+cleanToId(indice))[0].value)
						somme_valeurs += feature.properties[indice] * Number($('input[type=range]#'+cleanToId(indice))[0].value);
						
						somme_poids += Number($('input[type=range]#'+cleanToId(indice))[0].value);
					}
				}
				
				feature.properties.Combine = somme_valeurs / somme_poids
				
			}
			
		}
	
		mise_a_jour_indice_combine();
		
		let couches = []
		cles = Object.keys(indices);
		for (i=0;i<cles.length; i++ ) {
			
			cle = cles[i];
						
			couche = L.geoJSON(layers_picom, {
    		style: function (feature) {
				
				if (cle == "Type") {				
					color_function = getColorES(feature.properties[cle]);
				} else {
					color_function = getColorGradient(feature.properties[cle]);
				}
				
				return {
					fillColor: color_function,
					color: color_function,
					fillOpacity: fillOpacity
				};
			}})
			
			couche.id = cle;
						
			couches[indices[cle]] = couche
									
		}
		
		let layerControl = L.control.layers(couches).addTo(map);
			
		map.on("layeradd",function(e) {
			
			if (e.layer.id) { // L'événement se déclenche pour d'autres raisons?!				
				
				//console.log(cleanToId(e.layer.id))
				
				$(".legende").hide();
				$("#"+cleanToId(e.layer.id)).show();
				
				if (e.layer.id != "Type") {
					$(".echelle_couleurs").show();
					$(".echelle_es").hide();
				} else {
					$(".echelle_couleurs").hide();
					$(".echelle_es").show();
				}
			}
		})
		
		// Par défaut, activer la carte des écosystèmes
		couches[indices["Type"]].addTo(map);
		
				
		$('input[type=range]').on("change",function(){							
			
			mise_a_jour_indice_combine();			
			
			let couche = L.geoJSON(layers_picom, {
    		style: function (feature) {
				return {
					fillColor: getColorGradient(feature.properties['Combine']),
					color: getColorGradient(feature.properties['Combine']),
					fillOpacity: fillOpacity
				};
			}})	
			couche.id = "Combine";
			
			layerControl.removeLayer(couches[etiquette_indices_combines]);
			map.removeLayer(couches[etiquette_indices_combines]);
			
			couches[etiquette_indices_combines] = couche;
					
			map.addLayer(couches[etiquette_indices_combines],etiquette_indices_combines);
			layerControl.addBaseLayer(couches[etiquette_indices_combines],etiquette_indices_combines);
			
			
		})
		
		var legend = L.control({position: 'bottomright'});

		legend.onAdd = function (map) {

		    var div = L.DomUtil.create('div', 'info echelle_couleurs'),
		        grades = [0,1,2,3,4],
		        labels = [];

				for (var i = 0; i < grades.length; i++) {
		        div.innerHTML +=
		            '<i style="background:' + getColorGradient(grades[i] + 1) + '"></i> ' +
		            grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
		    }

		    return div;
		};

		legend.addTo(map);

		var legend2 = L.control({position: 'bottomright'});

		legend2.onAdd = function (map) {

		    var div = L.DomUtil.create('div', 'info echelle_es'),
		        grades = Object.keys(liste_couleurs_ecosystemes),
		        labels = [];

				for (var i = 0; i < grades.length; i++) {
		        div.innerHTML +=
		            '<i style="background:' + getColorES(grades[i]) + '"></i> ' + grades[i]  + '<br>';
		    }

		    return div;
		};

		legend2.addTo(map);
		
		$(".legende").hide();
		$(".echelle_couleurs").hide();
		$(".echelle_es").show();
				
	</script>
	<style>
		.echelle_couleurs, .echelle_es {
		    line-height: 18px;
		    color: #555;
			background-color:white;
			padding: 10px;
		}
		.echelle_couleurs i, .echelle_es i {
		    width: 18px;
		    height: 18px;
		    float: left;
		    margin-right: 8px;
		    opacity: 0.75;
		}
	</style>
</body>
</html>